(function(t){function e(e){for(var n,i,o=e[0],l=e[1],c=e[2],p=0,d=[];p<o.length;p++)i=o[p],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&d.push(r[i][0]),r[i]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);u&&u(e);while(d.length)d.shift()();return s.push.apply(s,c||[]),a()}function a(){for(var t,e=0;e<s.length;e++){for(var a=s[e],n=!0,o=1;o<a.length;o++){var l=a[o];0!==r[l]&&(n=!1)}n&&(s.splice(e--,1),t=i(i.s=a[0]))}return t}var n={},r={app:0},s=[];function i(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=n,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(a,n,function(e){return t[e]}.bind(null,n));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/maskmap/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var u=l;s.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"244b":function(t,e,a){},"2c95":function(t,e,a){},"56d7":function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Header"),a("div",{staticClass:"row ml-0 mr-0"},[a("SideBar",{attrs:{maskData:t.maskData,city:t.city,town:t.town,pages:t.pages,currentPage:t.currentPage,currentCity:t.currentCity,byAdult:t.byAdult,byChild:t.byChild},on:{"update:currentCity":function(e){t.currentCity=e},"update:current-city":function(e){t.currentCity=e},handleTownSelect:t.handleTownSelect,handleUpdateCenter:t.handleUpdateCenter,handlePageChange:t.handlePageChange,"update:byAdult":function(e){t.byAdult=e},"update:by-adult":function(e){t.byAdult=e},"update:byChild":function(e){t.byChild=e},"update:by-child":function(e){t.byChild=e}}}),a("div",{staticClass:"col-lg-8 col-xl-9 map pl-0 pr-0"},[a("Map",{attrs:{maskData:t.result,manualCenter:t.manualCenter}})],1)],1),a("Spinner",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}]})],1)},s=[],i=(a("4de4"),a("7db0"),a("d81d"),a("fb6a"),function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)}),o=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("nav",{staticClass:"navbar navbar-light bg-primary"},[a("span",{staticClass:"navbar-brand text-white ml-lg-3",attrs:{href:"javascript:;"}},[t._v("Mask Map 口罩地圖")])])}],l={},c=l,u=a("2877"),p=Object(u["a"])(c,i,o,!1,null,"1a702080",null),d=p.exports,h=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"col-lg-4 col-xl-3 col sidebar pl-md-5 pr-md-5"},[a("div",{staticClass:"form-group row mt-3"},[a("label",{staticClass:"col-3 col-form-label",attrs:{for:"city"}},[t._v("城市")]),a("select",{staticClass:"form-control col-7",attrs:{name:"",id:"city"},on:{change:function(e){return t.handleCitySelect(e)}}},[a("option",{attrs:{value:""}},[t._v("請選擇城市")]),t._l(t.city,(function(e){return a("option",{key:e.id,domProps:{value:e.value}},[t._v(t._s(e.name))])}))],2)]),a("div",{staticClass:"form-group row"},[a("label",{directives:[{name:"show",rawName:"v-show",value:""!==t.currentCity,expression:"currentCity !== ''"}],staticClass:"col-3 col-form-label",attrs:{for:"city"}},[t._v("地區")]),a("select",{directives:[{name:"show",rawName:"v-show",value:""!==t.currentCity,expression:"currentCity !== ''"}],staticClass:"form-control col-7",attrs:{name:"",id:"city"},on:{change:function(e){return t.handleTownSelect(e)}}},[a("option",{attrs:{value:""}},[t._v("請選擇地區")]),t._l(t.town,(function(e){return a("option",{key:e.id,domProps:{value:e.value}},[t._v(t._s(e.name))])}))],2)]),t.currentCity.length>0&&t.maskData.length>0?a("div",{staticClass:"pt-3 pb-3 d-flex align-items-end flex-wrap"},[a("h4",[t._v("搜尋結果")]),a("select",{staticClass:"ml-auto form-control",staticStyle:{width:"150px"},attrs:{name:"",id:""},on:{change:function(e){return t.handleSort(e)}}},[a("option",{attrs:{value:""}},[t._v("排序")]),a("option",{attrs:{value:"adult"}},[t._v("成人口罩")]),a("option",{attrs:{value:"child"}},[t._v("兒童口罩")])])]):t._e(),t.currentCity.length>0&&t.maskData.length>0?a("ul",{staticClass:"list-group"},t._l(t.maskData,(function(e){return a("PharmacyItem",{key:e.properties.name,attrs:{store:e},on:{handleUpdateCenter:t.handleUpdateCenter}})})),1):t._e(),t.currentCity.length>0&&t.maskData.length>0?a("div",{staticClass:"d-flex justify-content-center"},[a("Pagination",{attrs:{pages:t.pages,currentPage:t.currentPage},on:{handlePageChange:t.handlePageChange}})],1):t._e()])},m=[],f=(a("a9e3"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("li",{staticClass:"list-group-item border-0"},[a("div",{staticClass:"card"},[a("div",{staticClass:"card-body"},[a("h5",{staticClass:"card-title d-flex align-items-center"},[a("strong",{staticClass:"text-primary"},[t._v(t._s(t.store.properties.name))])]),a("p",{directives:[{name:"show",rawName:"v-show",value:t.open,expression:"open"}],staticClass:"card-text mt-n2"},[t._v(" "+t._s(t.store.properties.address)+" ")]),a("p",{staticClass:"card-text mt-n2"},[a("span",{staticClass:"mr-2 text-danger"},[a("strong",{staticClass:"text-dark"},[t._v("成人口罩: ")]),t._v(t._s(t.store.properties.mask_adult))]),a("span",{staticClass:"text-danger"},[a("strong",{staticClass:"text-dark"},[t._v("兒童口罩: ")]),t._v(t._s(t.store.properties.mask_child))])]),a("p",{directives:[{name:"show",rawName:"v-show",value:t.open,expression:"open"}],staticClass:"card-text mt-n2"},[t._v(" 聯絡電話："+t._s(t.store.properties.phone)+" ")]),a("p",{directives:[{name:"show",rawName:"v-show",value:t.open,expression:"open"}],staticClass:"card-text mt-n2"},[t._v(" 備註："+t._s(t.store.properties.note)+" ")]),a("p",{directives:[{name:"show",rawName:"v-show",value:t.open,expression:"open"}],staticClass:"card-text mt-n2"},[a("small",{staticClass:"text-secondary"},[t._v("更新時間："+t._s(t.store.properties.updated))])]),a("div",{staticClass:"d-flex"},[a("a",{directives:[{name:"show",rawName:"v-show",value:!t.open,expression:"!open"}],staticClass:"mr-2 btn btn-primary text-white",attrs:{href:"javascript:;"},on:{click:t.handleOpen}},[t._v("詳情")]),a("a",{directives:[{name:"show",rawName:"v-show",value:t.open,expression:"open"}],staticClass:"mr-2 btn btn-primary text-white",attrs:{href:"javascript:;"},on:{click:t.handleOpen}},[t._v("詳情")]),a("a",{staticClass:"btn btn-info text-white",attrs:{href:"#map"},on:{click:function(e){return t.handleUpdateCenter(t.store.geometry.coordinates)}}},[t._v("地圖")])])])])])}),v=[],g={props:{store:{type:Object,required:!0}},data:function(){return{open:!1}},methods:{handleOpen:function(){this.open=!this.open},handleUpdateCenter:function(t){this.$emit("handleUpdateCenter",t)}}},y=g,C=Object(u["a"])(y,f,v,!1,null,"27221790",null),b=C.exports,_=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("nav",{staticClass:"mt-3"},[t.pages>1?a("ul",{staticClass:"pagination d-flex flex-wrap"},[a("li",{staticClass:"page-item"},[a("a",{staticClass:"page-link",attrs:{href:"javascript:;","aria-label":"Previous"},on:{click:function(e){return t.handleClick("dec")}}},[a("span",{attrs:{"aria-hidden":"true"}},[t._v("«")])])]),t._l(t.pages,(function(e){return a("li",{key:e,staticClass:"page-item",class:{active:e-1===t.currentPage}},[a("a",{staticClass:"page-link",attrs:{href:"javascript:;"},on:{click:function(a){return t.handleClick(e-1)}}},[t._v(t._s(e))])])})),a("li",{staticClass:"page-item"},[a("a",{staticClass:"page-link",attrs:{href:"javascript:;","aria-label":"Next"},on:{click:function(e){return t.handleClick("inc")}}},[a("span",{attrs:{"aria-hidden":"true"}},[t._v("»")])])])],2):t._e()])},w=[],k={props:{pages:{type:Number,required:!0},currentPage:{type:Number,required:!0}},methods:{handleClick:function(t){this.$emit("handlePageChange",t)}}},x=k,P=Object(u["a"])(x,_,w,!1,null,null,null),j=P.exports,O={components:{PharmacyItem:b,Pagination:j},props:{byAdult:{type:Boolean,required:!0},byChild:{type:Boolean,required:!0},currentCity:{type:String,required:!0},city:{type:Array,required:!0},town:{type:Array,required:!0},maskData:{type:Array,required:!0},pages:{type:Number,required:!0},currentPage:{type:Number,required:!0}},methods:{handleCitySelect:function(t){this.$emit("update:currentCity",t.target.value)},handleTownSelect:function(t){this.$emit("handleTownSelect",t.target.value)},handleUpdateCenter:function(t){this.$emit("handleUpdateCenter",t)},handlePageChange:function(t){this.$emit("handlePageChange",t)},handleSort:function(t){var e=t.target.value;"adult"===e?(this.$emit("update:byAdult",!0),this.$emit("update:byChild",!1)):"child"===e?(this.$emit("update:byChild",!0),this.$emit("update:byAdult",!1)):(this.$emit("update:byChild",!1),this.$emit("update:byAdult",!1))}}},A=O,S=(a("deac"),Object(u["a"])(A,h,m,!1,null,"a48416f4",null)),D=S.exports,$=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("l-map",{attrs:{zoom:t.zoom,center:t.center}},[a("l-tile-layer",{attrs:{url:t.url,attribution:t.attribution}}),t._l(t.maskData,(function(e,n){return a("l-marker",{key:n,attrs:{"lat-lng":t.convertCoordinateFormat(e.geometry.coordinates)}},[a("l-tooltip",{attrs:{options:{permanent:parseInt(t.manualCenter[0])===parseInt(e.geometry.coordinates[0])&&parseInt(t.manualCenter[1])===parseInt(e.geometry.coordinates[1])}}},[a("h5",{staticClass:"font-weight-bold text-primary"},[t._v(t._s(e.properties.name))]),a("p",{staticClass:"mt-n2"},[t._v(t._s(e.properties.phone))]),a("p",{staticClass:"mt-n2"},[t._v(t._s(e.properties.address))]),a("p",{staticClass:"mt-n2",staticStyle:{"font-size":"1.1rem"}},[a("span",{staticClass:"mr-2 d-block text-danger"},[a("strong",[t._v("成人口罩")]),t._v("："+t._s(e.properties.mask_adult))]),a("span",{staticClass:"text-danger"},[a("strong",[t._v("兒童口罩")]),t._v("："+t._s(e.properties.mask_child))])])])],1)}))],2)},N=[],U=a("e11e"),M={props:{maskData:{type:Array,required:!0},manualCenter:{type:Array,default:null}},data:function(){return{zoom:16,center:Object(U["latLng"])(25.0475613,121.5173399),url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}},methods:{convertCoordinateFormat:function(t){return Object(U["latLng"])(t[1],t[0])}},watch:{maskData:{handler:function(){this.center=this.convertCoordinateFormat(this.maskData[0].geometry.coordinates),this.zoom=16}},manualCenter:{handler:function(){this.center=this.convertCoordinateFormat(this.manualCenter),this.zoom=18}}}},q=M,T=Object(u["a"])(q,$,N,!1,null,null,null),I=T.exports,E=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},F=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"spinner-border spinner",staticStyle:{width:"2rem",height:"2rem"},attrs:{role:"status"}},[a("span",{staticClass:"sr-only"},[t._v("Loading...")])])}],z={},B=z,L=(a("8f0e"),Object(u["a"])(B,E,F,!1,null,"03b55acc",null)),H=L.exports,J={name:"App",components:{Header:d,SideBar:D,Map:I,Spinner:H},data:function(){return{data:[],currentCity:"",currentTown:"",city:[],result:[],maskData:[],manualCenter:[],pages:0,limit:3,currentPage:0,byAdult:!1,byChild:!1,loading:!1}},computed:{town:{get:function(){var t=this,e=this.data.find((function(e){return e.CityName===t.currentCity}));return e?e.AreaList.map((function(t){return{name:t.AreaName,value:t.AreaName,id:t.ZipCode}})):[]}},startPage:function(){return this.currentPage*this.limit},endPage:function(){return this.startPage+this.limit}},watch:{byAdult:{handler:function(){this.resetPageAndFetch()}},byChild:{handler:function(){this.resetPageAndFetch()}}},methods:{fetchCityData:function(){var t=this;this.axios.get("/maskmap/cityCountyData.json").then((function(e){t.data=e.data,t.city=e.data.map((function(t,e){return{name:t.CityName,value:t.CityName,id:e}}))}))},fetchMaskData:function(t,e){var a=this;return this.loading=!0,this.axios.get("https://raw.githubusercontent.com/kiang/pharmacies/master/json/points.json").then((function(n){var r=n.data;a.result=r.features.filter((function(t){return t.properties.town===a.currentTown&&t.properties.county===a.currentCity})),a.byAdult&&a.result.sort((function(t,e){return t.properties.mask_adult-e.properties.mask_adult})).reverse(),a.byChild&&a.result.sort((function(t,e){return t.properties.mask_child-e.properties.mask_child})).reverse(),a.maskData=a.result.slice(t,e),a.pages=Math.ceil(a.result.length/a.limit),a.loading=!1}))},resetPageAndFetch:function(){this.currentPage=0,this.fetchMaskData(this.startPage,this.endPage)},handleTownSelect:function(t){this.currentTown=t,this.resetPageAndFetch()},handlePageChange:function(t){"inc"===t?this.currentPage+1!==this.pages&&(this.currentPage+=1):"dec"===t?this.currentPage>0&&(this.currentPage-=1):this.currentPage=parseInt(t),this.fetchMaskData(this.startPage,this.endPage)},handleUpdateCenter:function(t){this.manualCenter=t}},created:function(){this.fetchCityData()}},R=J,Z=(a("5c0b"),Object(u["a"])(R,r,s,!1,null,null,null)),G=Z.exports,K=a("bc3a"),Q=a.n(K),V=a("a7fe"),W=a.n(V),X=a("2699"),Y=a("a40a"),tt=a("4e2b"),et=a("31dc");a("6cc5");delete U["Icon"].Default.prototype._getIconUrl,U["Icon"].Default.mergeOptions({iconRetinaUrl:a("584d"),iconUrl:a("6397"),shadowUrl:a("e2b9")}),n["a"].component("l-map",X["a"]),n["a"].component("l-tile-layer",Y["a"]),n["a"].component("l-marker",tt["a"]),n["a"].component("l-tooltip",et["a"]),n["a"].config.productionTip=!1,n["a"].use(W.a,Q.a),new n["a"]({render:function(t){return t(G)}}).$mount("#app")},"5c0b":function(t,e,a){"use strict";var n=a("9c0c"),r=a.n(n);r.a},"8f0e":function(t,e,a){"use strict";var n=a("244b"),r=a.n(n);r.a},"9c0c":function(t,e,a){},deac:function(t,e,a){"use strict";var n=a("2c95"),r=a.n(n);r.a}});
//# sourceMappingURL=app.9efb630f.js.map